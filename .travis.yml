language: rust

# from https://levans.fr/rust_travis_cache.html
cache:
    directories:
        - /home/travis/.cargo
        - $SDL_DIR
        - $BULLET_DIR
before_cache:
    - rm -rf /home/travis/.cargo/registry

#before_install:
#    - sudo apt install libbullet-dev
#    - git clone
#addons:
#    apt:
#        update: true

# ---

branches:
    only:
        - develop
        - master

install:
    - bash .travis-install-sdl2.sh
    - bash .travis-install-bullet.sh

env:
    SDL_DIR=SDL2-2.0.9
    BULLET_DIR=bullet3-2.89
os:
    - linux
      # TODO windows and osx
rust:
    - stable
    - nightly


#matrix:
#  fast_finish: true
#  allow_failures:
#  include:
#    - env: NAME='cargo-travis'
#      sudo: required # travis-ci/travis-ci#9061
#      before_script:
#        - cargo install cargo-update || echo "cargo-update already installed"
#        - cargo install cargo-travis || echo "cargo-travis already installed"
#        - cargo install-update -a
#      script:
#        - |
#          cargo build --verbose &&
#          cargo coverage --verbose # &&
#          bash <(curl -s https://codecov.io/bash) -s target/kcov
#      addons: # required for kcov
#        apt:
#          packages:
#            - libcurl4-openssl-dev
#            - libelf-dev
#            - libdw-dev
#            - binutils-dev
#            - cmake

script: |
        export PATH=$PATH:/usr/local/lib &&
        export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/lib &&
        export DYLD_LIBRARY_PATH=$DYLD_LIBRARY_PATH:/usr/local/lib &&
        env &&
        export RUST_BACKTRACE=1 &&
        export NN_LOG=debug &&
        cargo build --verbose --workspace &&
        cargo test --verbose --workspace &&
        cargo test --verbose -- --ignored &&
        cd renderer/main && cargo run --verbose --features lite --no-default-features -- --preset dev --dir ../../
